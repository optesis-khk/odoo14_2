<?xml version="1.0" encoding="utf-8"?>
<odoo>
       
    
    
        <record model="ir.actions.act_window" id="action_element_variable">
            <field name="name">Eléments variables</field>
            <field name="res_model">hr.employee.bonus</field>
            <field name="view_mode">tree,form</field>
        </record>
   
    
             <menuitem
        id="menu_element_variable"
        action="action_element_variable"
        parent="hr_work_entry_contract.menu_hr_payroll_configuration"
        sequence="10"/>
    
    <!-- Contract View add by mpb -->
     <record id="hr_contract_form_inherit" model="ir.ui.view">
        <field name="name">hr.contract.view.form.inherit</field>
        <field name="model">hr.contract</field>
        <field name="inherit_id" ref="hr_contract.hr_contract_view_form"/>
        <field name="arch" type="xml">
            <data> 
              <xpath expr="//form" position="replace">
                   <form string="Current Contract">
                    <header>
                        <field name="state" widget="statusbar" options="{'clickable': '1'}"/>
                    </header>
                    <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    <div class="oe_title" name="title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Contract Reference"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="company_id" invisible="1"/>
                            <field name="employee_id"/>
                            <field name="department_id"/>
                            <field name="job_id"/>
                        </group>
                        <group>
                            <!--<field name="type_id"/>-->
                            <field name="struct_id"/>
                           <!-- <field name="reported_to_secretariat" widget="toggle_button" options='{"active": "Reported to the social secretariat", "inactive": "To report to the social secretariat"}'/>-->
                        </group>
                    </group>
                    <notebook>
                        <page string="Contract Details" name="other">
                            <group>
                                <group name="duration_group" string="Contract Terms">
                                    <field name="date_start"/>
                                    <label for="date_end"/>
                                    <div class="o_row">
                                        <field name="date_end" nolabel="1"/>
                                        <span class="text-muted">(If fixed-term contract)</span>
                                    </div>
                                    <field name="trial_date_end"/>
                                    <field name="resource_calendar_id"/>
                                   <!-- <field name="resource_calendar_id"/>-->
                                </group>
                            </group>
                            <group string="Notes">
                                <field name="notes" nolabel="1"/>
                            </group>
                        </page>
                        <page string="Salary Information" name="information">
                            <group name="main_info">
                                <group name="salary_and_advantages" string="Monthly Advantages in Cash">
                                    <label for="wage"/>
                                    <div class="o_row" name="wage">
                                        <field name="wage" nolabel="1"/>
                                        <span>/ month</span>
                                    </div>
                                    <!--<field name="advantages" nolabel="1" placeholder="Advantages..." colspan="2" invisible="1"/>-->
                                </group>
                            </group>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
                  
              </xpath> 
            </data>
            

        </field>
    </record>
       
      

        <record id="hr_contract_bonus_form_inherit_2" model="ir.ui.view">
            <field name="name">hr.contract.view.bonus.form.inherit</field>
            <field name="model">hr.contract</field>
            <field name="inherit_id" ref="optipay.hr_contract_form_inherit"/>
            <field name="arch" type="xml">
               <xpath expr="//page[@name='information']" position="after">
                <page name="bonus" string="Elements variables">
                    <field name="bonus" context="{'default_contract_id':id,'default_employee_id':employee_id}"/>
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="bonus_total">
                        <field name="total_bonus" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    </group>
                </page>
                <page string="Congés">
                  <group string="Initialisation" invisible="1">
                    <group>
                      <field name="cumul_jour"/>
                    </group>
                    <group>
                      <field name="cumul_conges"/>
                    </group>
                  </group>
                  <group string="Nombre de jours aquis et nombre de jours pris">
                    <group>
                       <label for="nbj_aquis" string="Nombre jours aquis" readonly="True"/>
                      <div>
                        <field name="nbj_aquis" class="oe_inline" readonly="True"/> Jours
                      </div>
                    </group>
                    <group>
                       <label for="nbj_sup" string="Nombre jours supplementaire" readonly="True"/>
                      <div>
                        <field name="nbj_sup" class="oe_inline" readonly="True"/> Jours
                      </div>
                    </group>
                     <group>
                      <label for="nbj_pris" string="Nombre jours pris" readonly="True"/>
                      <div>
                        <field name="nbj_pris" class="oe_inline" readonly="True"/> Jours
                      </div>
                    </group>
                    <group>
                      <label for="nbj_restant" string="Nombre jours rastant" readonly="True"/>
                      <div>
                        <field name="nbj_restant" class="oe_inline" readonly="True"/> Jours
                      </div>
                    </group>
                  </group>
                  <group string="Calcul allocation congés">
                    <group>
                      <field name="cumul_mensuel" readonly="True"/>
                      <field name="cumul_provision_fin_contrat" invisible="True"/>
                      <field name="last_date" invisible="True"/>
                    </group>
                    <group>
                      <field name="alloc_conges"/>
                    </group>
                  </group>
                  <group>
                    <group>
                      <label for="nb_days"/>
                      <div><field name="nb_days" class="oe_inline"/> Jours </div>
                    </group>
                  </group>
              </page>
              <page string="Suivi congès payés">
                <field name="holidays_tracking">
                  <tree editable="bottom">
                    <field name="date_from" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="date_to" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="number_of_days" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="state"/>
                  </tree>
                </field>
                <field name="year_extra_day_anciennete" invisible="True"/>
              </page>
            </xpath>

            <field name="wage" position="before">
              <field name="convention_id"/>
            </field>

           
                
            <!--<xpath expr="//field[@name='date_end']" position="after">
              <field name="motif"/>
              <field name="dateAnciennete" required="1"/>
            </xpath>-->
            <xpath expr="//page[@name='other']/group/group/div" position="after">
                 <field name="motif"/>
                 <field name="dateAnciennete" required="1"/>
            </xpath>
                
            

            <xpath expr="//form/sheet/group/group/field[1]" position="before">
              <field name="typeContract" required="1"/>
            </xpath>

          </field>
        </record>

        <record id="employee_bonus__details_form" model="ir.ui.view">
            <field name="name">Employee Bonus</field>
            <field name="model">hr.employee.bonus</field>
            <field name="arch" type="xml">
                <form string="Employee bonus">

                    <sheet>
                        <group>
                            <group>
                                <field name="employee_id"/>
                                <field name="salary_rule_id" />
                                <label for="date_from" string="Policy Period"/>
                          			<div>
                          				<field name="date_from" class="oe_inline" on_change="1" />
                          				  -
                          				<field name="date_to" class="oe_inline" on_change="1" />
                          			</div>
                            </group>
                            <group>
                                <field name="amount"/>
                                <field name="company_id"/>
                                <field name="contract_id"/>
                            </group>
                        </group>

                    </sheet>
                </form>
            </field>
        </record>
    
        <record id="employee_bonus__details_tree" model="ir.ui.view">
            <field name="name">Employee Bonus</field>
            <field name="model">hr.employee.bonus</field>
            <field name="arch" type="xml">
                <tree string="Employee Bonus">
                     <field name="salary_rule_id"/>
                    <field name="date_from" />
				            <field name="date_to"/>
                    <field name="amount"/>
                    <field name="company_id"/>
                    <field name="contract_id"/>
                </tree>
            </field>
        </record>
    
        <record id="view_hr_employee_bonus_filter" model="ir.ui.view">
            <field name="name">hr.employee.bonus.filter</field>
            <field name="model">hr.employee.bonus</field>
            <field name="arch" type="xml">
                <search string="Element Variable Recherche">
                    <field name="employee_id" string="Employé"/>
                    <field name="salary_rule_id" string="Règle salariale"/>
                    <group col="8" colspan="4" expand="0" string="Group By">
                        <filter string="Employé" name="employee_id" context="{'group_by':'employee_id'}"/>
                        <filter string="Règle salariale" name="salary_rule_id" context="{'group_by':'salary_rule_id'}"/>
                    </group>
                </search>
            </field>
        </record>
    
    <!-- Masqué by diw
        <record id="element_variable_action" model="ir.actions.act_window">
            <field name="name">Element Variables</field>
            <field name="res_model">hr.employee.bonus</field>
            <field name="view_mode">tree,form</field>
        </record>

      <menuitem id="element_variable_menu"
         parent="hr_payroll.menu_hr_payroll_payslips" action="element_variable_action"
         sequence="19"/>
    fin diw -->

    <!-- affiche amount par defaut -->
    <record id="view_hr_payslip_line_pivot" model="ir.ui.view">
       <field name="name">hr.payslip.line.pivot</field>
       <field name="model">hr.payslip.line</field>
       <field name="arch" type="xml">
           <pivot string="Lignes de paie" >
               <field name="total" type="measure"/>
           </pivot>
       </field>
    </record>

    <record id="hr_payslip_form_inherit" model="ir.ui.view">
        <field name="name">hr.payslip.form.inherit</field>
        <field name="model">hr.payslip</field>
        <field name="priority">30</field>
        <field name="inherit_id" ref="hr_payroll.view_hr_payslip_form"/>
        <field name="arch" type="xml">

          <xpath expr="//form/sheet/notebook/page/field/tree/field[@name='number_of_hours']" position="attributes">
            <attribute name="groups">base.group_system</attribute>
          </xpath>

          <xpath expr="//form/sheet/notebook/page/field/tree/field[@name='contract_id']" position="attributes">
            <attribute name="groups">base.group_system</attribute>
          </xpath>

          <xpath expr="//form/sheet/notebook/page/field[2]/tree/field[@name='contract_id']" position="attributes">
            <attribute name="groups">base.group_system</attribute>
          </xpath>

          <xpath expr="//form/header/button[1]" position="attributes">
            <attribute name="states">validate</attribute>
          </xpath>

          <xpath expr="//form/header/field[1]" position="attributes">
            <attribute name="statusbar_visible">draft,validate,done</attribute>
          </xpath>

          <xpath expr="//form/header/button[@name='action_payslip_done']" position="after">
            <button string="Valider" name="action_payslip_validate" states="draft" type="object" class="oe_highlight"/>
          </xpath>

          <xpath expr="//form/header/button[@name='action_payslip_done']" position="replace">
            <button string="Clôturer" name="action_payslip_done" states="validate" type="object" class="oe_highlight"/>
          </xpath>

          <xpath expr="//form/header/button[@name='action_payslip_cancel']" position="after">
            <button string="Net Simulation" name="%(action_payslip_simulation)d" states="draft" type="action"/>
          </xpath>
            
          <xpath expr="//field[@name='name']" position="after">
              <field name="nb_part_of_payslip" invisible="True"/>
              <field name="payslip_count_yearly" invisible="True"/>
              <field name="year" invisible="True"/>
              <field name="holiday_of_payslip" invisible="True"/>
          </xpath>
          
        </field>
    </record>
    

    <record id="hr_payslip_run_form_inherit_batch_pay" model="ir.ui.view">
        <field name="name">hr.payslip.run.form.inherit.batch.pay</field>
        <field name="model">hr.payslip.run</field>
        <field name="inherit_id" ref="hr_payroll.hr_payslip_run_form"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//header" position="inside">
                    <button name="validate_payslip" type="object" string="Valider" states="draft" class="oe_highlight"/>
                    <button name="action_validate" type="object" string="Clôturer" states="validate" class="oe_highlight" context="{'payslip_generate_pdf': True}"/>
                        <!--<button name="pay_payslip" type="object" string="Confirmer" states="validate" class="oe_highlight"/>-->
                </xpath>
            </data>
            </field>
        </record>


    <!--apply domain in hr payslip line-->
    <record id="hr_payroll_payslip_line_company" model="ir.rule">
        <field name="name">Payslips line of my Company</field>
        <field name="model_id" ref="hr_payroll.model_hr_payslip_line"/>
        <field eval="False" name="global"/>
        <field name="domain_force">['|',('company_id','=',False),('company_id','child_of',[user.company_id.id])]</field>
        <field name="groups" eval="[(4,ref('base.group_user'))]"/>
    </record>

</odoo>
